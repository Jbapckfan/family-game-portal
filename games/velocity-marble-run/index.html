<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Marble POV: Velocity" />
    <meta name="theme-color" content="#050505" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="description" content="Marble POV: Velocity - A high-speed 3D marble physics runner with collectibles, power-ups, and unlockable marbles.">
    <meta property="og:title" content="Marble POV: Velocity">
    <meta property="og:description" content="A high-speed 3D marble physics runner with collectibles, power-ups, and unlockable marbles.">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <title>Marble POV: Velocity</title>
    <!-- Feature 8: Custom Favicon via Inline SVG (marble/sphere) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3CradialGradient id='g' cx='40%25' cy='35%25' r='55%25'%3E%3Cstop offset='0%25' stop-color='%2380ffff'/%3E%3Cstop offset='50%25' stop-color='%2300c8d4'/%3E%3Cstop offset='100%25' stop-color='%23003844'/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='32' cy='32' r='30' fill='url(%23g)' stroke='%2300f0ff' stroke-width='1.5'/%3E%3Cellipse cx='24' cy='22' rx='10' ry='7' fill='rgba(255,255,255,0.25)' transform='rotate(-25 24 22)'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
      * {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #050505;
        font-family: 'Rajdhani', sans-serif;
        position: fixed;
        width: 100%;
        height: 100%;
        touch-action: none;
      }
      #root {
        width: 100%;
        height: 100%;
        position: fixed;
        top: env(safe-area-inset-top, 0px);
        left: env(safe-area-inset-left, 0px);
        right: env(safe-area-inset-right, 0px);
        bottom: env(safe-area-inset-bottom, 0px);
      }
      /* Feature 2: Custom CSS Scrollbar with Neon Glow */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track {
        background: #0a0a0a;
        border-radius: 4px;
        border: 1px solid #1a1a2e;
      }
      ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #00f0ff 0%, #007a85 100%);
        border-radius: 4px;
        box-shadow: 0 0 6px rgba(0, 240, 255, 0.5), 0 0 12px rgba(0, 240, 255, 0.2);
      }
      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, #33f5ff 0%, #00b8c8 100%);
        box-shadow: 0 0 10px rgba(0, 240, 255, 0.7), 0 0 20px rgba(0, 240, 255, 0.35);
      }
      ::-webkit-scrollbar-corner { background: #0a0a0a; }
      /* Firefox scrollbar */
      * {
        scrollbar-width: thin;
        scrollbar-color: #00f0ff #0a0a0a;
      }

      /* Feature 1: Loading Screen Styles */
      #loading-overlay {
        position: fixed;
        inset: 0;
        z-index: 99999;
        background: #050505;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 28px;
        transition: opacity 0.5s ease-out;
      }
      #loading-overlay.fade-out {
        opacity: 0;
        pointer-events: none;
      }
      #loading-overlay .spinner {
        width: 52px;
        height: 52px;
        border-radius: 50%;
        border: 3px solid #1a1a2e;
        border-top-color: #00f0ff;
        animation: loading-spin 0.9s linear infinite;
        box-shadow: 0 0 15px rgba(0, 240, 255, 0.3);
      }
      #loading-overlay .loading-text {
        font-family: 'Orbitron', sans-serif;
        font-size: 18px;
        font-weight: 700;
        color: #00f0ff;
        letter-spacing: 6px;
        text-transform: uppercase;
        animation: loading-pulse 1.5s ease-in-out infinite;
        text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
      }
      #loading-overlay .loading-sub {
        font-family: 'Rajdhani', sans-serif;
        font-size: 13px;
        color: #555;
        letter-spacing: 2px;
      }
      @keyframes loading-spin {
        to { transform: rotate(360deg); }
      }
      @keyframes loading-pulse {
        0%, 100% { opacity: 0.4; }
        50% { opacity: 1; }
      }

      /* Feature 10: Error Overlay Styles */
      #error-overlay {
        position: fixed;
        inset: 0;
        z-index: 999999;
        background: rgba(5, 5, 5, 0.95);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 20px;
        padding: 24px;
        text-align: center;
      }
      #error-overlay.visible { display: flex; }
      #error-overlay .error-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: 2px solid #ff4060;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        color: #ff4060;
        box-shadow: 0 0 20px rgba(255, 64, 96, 0.3);
      }
      #error-overlay .error-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 20px;
        font-weight: 700;
        color: #ff4060;
        letter-spacing: 2px;
      }
      #error-overlay .error-msg {
        font-family: 'Rajdhani', sans-serif;
        font-size: 16px;
        color: #aaa;
        max-width: 400px;
        line-height: 1.5;
      }
      #error-overlay .error-btn {
        margin-top: 8px;
        padding: 12px 32px;
        background: transparent;
        border: 1px solid #ff4060;
        border-radius: 10px;
        color: #ff4060;
        font-family: 'Orbitron', sans-serif;
        font-size: 14px;
        font-weight: 700;
        letter-spacing: 2px;
        cursor: pointer;
        transition: all 0.2s;
        min-height: 44px;
      }
      #error-overlay .error-btn:hover {
        background: rgba(255, 64, 96, 0.15);
        box-shadow: 0 0 15px rgba(255, 64, 96, 0.3);
      }

      /* Feature 3: Fullscreen Toggle Button */
      #fullscreen-btn {
        position: fixed;
        bottom: 12px;
        right: 12px;
        z-index: 9999;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        padding: 8px 12px;
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        transition: background 0.2s;
        min-height: 44px;
        min-width: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        line-height: 1;
      }
      #fullscreen-btn:hover { background: rgba(0, 0, 0, 0.9); }
      #fullscreen-btn svg { width: 18px; height: 18px; fill: #fff; }
      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    </style>
    <link rel="modulepreload" href="./assets/index-CsjiDm7H.js">
    <link rel="manifest" href="./manifest.json">
    <script type="module" crossorigin src="./assets/index-CsjiDm7H.js"></script>
  </head>
  <body>

  <!-- Feature 1: Loading Screen with Progress Indicator -->
  <div id="loading-overlay">
    <div class="spinner"></div>
    <div class="loading-text">Loading</div>
    <div class="loading-sub">Preparing the track...</div>
  </div>

  <a href="../../" aria-label="Return to main menu" style="position:fixed;top:12px;left:12px;z-index:9999;background:rgba(0,0,0,0.7);color:#fff;text-decoration:none;padding:8px 14px;border-radius:10px;font-family:-apple-system,BlinkMacSystemFont,sans-serif;font-size:14px;font-weight:600;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.15);transition:background 0.2s;min-height:44px;display:flex;align-items:center;gap:6px;" onmouseover="this.style.background='rgba(0,0,0,0.9)'" onmouseout="this.style.background='rgba(0,0,0,0.7)'">üè† Menu</a>

  <!-- Feature 3: Fullscreen Toggle Button -->
  <button id="fullscreen-btn" aria-label="Toggle fullscreen" title="Toggle fullscreen">
    <svg id="fs-icon-enter" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
    <svg id="fs-icon-exit" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="display:none"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>
  </button>

    <div id="root"></div>

  <!-- Feature 10: Error Boundary Fallback UI -->
  <div id="error-overlay">
    <div class="error-icon">!</div>
    <div class="error-title">Something Went Wrong</div>
    <div class="error-msg">An unexpected error occurred. This can happen if your browser lost the graphics context or ran out of memory.</div>
    <button class="error-btn" onclick="location.reload()">REFRESH PAGE</button>
    <a href="../../" style="margin-top:4px;color:#666;font-family:'Rajdhani',sans-serif;font-size:14px;text-decoration:underline;text-underline-offset:3px;">Return to Menu</a>
  </div>

    <noscript>
      <div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#050505;color:#00f0ff;font-family:'Rajdhani',sans-serif;text-align:center;padding:20px;">
        <p>This game requires JavaScript and a WebGL-capable browser to play.</p>
      </div>
    </noscript>

  <!-- Feature 1: Loading Screen - MutationObserver to detect app mount -->
  <script>
    (function() {
      var overlay = document.getElementById('loading-overlay');
      var root = document.getElementById('root');
      if (!overlay || !root) return;

      var observer = new MutationObserver(function(mutations) {
        for (var i = 0; i < mutations.length; i++) {
          if (mutations[i].addedNodes.length > 0) {
            overlay.classList.add('fade-out');
            setTimeout(function() {
              if (overlay.parentNode) overlay.parentNode.removeChild(overlay);
            }, 600);
            observer.disconnect();
            return;
          }
        }
      });
      observer.observe(root, { childList: true });

      // Fallback: remove loading screen after 20 seconds regardless
      setTimeout(function() {
        if (overlay.parentNode) {
          overlay.classList.add('fade-out');
          setTimeout(function() {
            if (overlay.parentNode) overlay.parentNode.removeChild(overlay);
          }, 600);
        }
        observer.disconnect();
      }, 20000);
    })();
  </script>

  <!-- Feature 3: Fullscreen Toggle - Inline Script -->
  <script>
    (function() {
      var btn = document.getElementById('fullscreen-btn');
      var iconEnter = document.getElementById('fs-icon-enter');
      var iconExit = document.getElementById('fs-icon-exit');
      if (!btn || !document.fullscreenEnabled && !document.webkitFullscreenEnabled) {
        if (btn) btn.style.display = 'none';
        return;
      }

      function isFullscreen() {
        return !!(document.fullscreenElement || document.webkitFullscreenElement);
      }

      function updateIcon() {
        var fs = isFullscreen();
        iconEnter.style.display = fs ? 'none' : 'block';
        iconExit.style.display = fs ? 'block' : 'none';
      }

      btn.addEventListener('click', function() {
        if (isFullscreen()) {
          if (document.exitFullscreen) document.exitFullscreen();
          else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
        } else {
          var el = document.documentElement;
          if (el.requestFullscreen) el.requestFullscreen();
          else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        }
      });

      document.addEventListener('fullscreenchange', updateIcon);
      document.addEventListener('webkitfullscreenchange', updateIcon);
    })();
  </script>

  <!-- Feature 10: Error Boundary - Global Error Handlers -->
  <script>
    (function() {
      var errorOverlay = document.getElementById('error-overlay');
      var hasShown = false;

      function showError() {
        if (hasShown || !errorOverlay) return;
        hasShown = true;
        errorOverlay.classList.add('visible');
        // Hide the loading overlay if still present
        var loadingOverlay = document.getElementById('loading-overlay');
        if (loadingOverlay && loadingOverlay.parentNode) {
          loadingOverlay.parentNode.removeChild(loadingOverlay);
        }
      }

      // Catch uncaught JS errors (only show for fatal-looking errors, not minor warnings)
      window.addEventListener('error', function(e) {
        // Skip errors from extensions or cross-origin scripts
        if (e.filename && e.filename.indexOf(location.origin) === -1) return;
        // Show for errors that are likely to break the game
        if (e.message && (
          /webgl/i.test(e.message) ||
          /context/i.test(e.message) ||
          /out of memory/i.test(e.message) ||
          /cannot read/i.test(e.message) ||
          /is not defined/i.test(e.message) ||
          /null/i.test(e.message) ||
          /undefined/i.test(e.message) ||
          /failed to/i.test(e.message)
        )) {
          showError();
        }
      });

      // Catch unhandled promise rejections
      window.addEventListener('unhandledrejection', function(e) {
        var reason = e.reason;
        var msg = (reason && (reason.message || String(reason))) || '';
        if (/webgl/i.test(msg) || /context/i.test(msg) || /chunk/i.test(msg) ||
            /loading/i.test(msg) || /network/i.test(msg) || /failed/i.test(msg) ||
            /module/i.test(msg)) {
          showError();
        }
      });

      // Catch WebGL context loss directly
      document.addEventListener('webglcontextlost', function(e) {
        e.preventDefault();
        showError();
      }, true);
    })();
  </script>

  </body>
</html>
